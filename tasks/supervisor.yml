
- name: Install web related system packages
  apt: pkg={{ item }} state={{ galaxy_extras_apt_package_state }}
  with_items:
    - uwsgi
    - uwsgi-plugin-python
    - supervisor
  when: galaxy_extras_install_packages

- name: Create Galaxy configuration file
  template: src=supervisor.conf.j2 dest={{ supervisor_conf_path }}

- name: Stop services before removing them.
  service: name={{ item }} state=stopped
  with_items:
  - nginx
  - uwsgi
  - proftpd
  - munge
  - slurm-llnl

- name: Disable init scripts for stuff managed by supervisor.
  command: update-rc.d -f {{ item }} remove || true
  with_items:
  - nginx
  - uwsgi
  - proftpd
  - munge
  - slurm-llnl

- service: name=supervisor state=restart
