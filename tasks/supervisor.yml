
- name: Install web related system packages
  apt: pkg={{ item }} state={{ galaxy_extras_apt_package_state }}
  with_items:
    - uwsgi
    - uwsgi-plugin-python
    - supervisor
  when: galaxy_extras_install_packages

- name: Create Galaxy configuration file
  template: src=supervisor.conf.j2 dest={{ supervisor_conf_path }}

- name: Stop services before removing them.
  service: name={{ item }} state=stopped
  with_items:
    - uwsgi
    - munge

- name: Disable init scripts for stuff managed by supervisor.
  service: name={{ item }} enabled=false
#  command: update-rc.d -f {{ item }} remove || true
  with_items:
  - uwsgi
  - munge

- name: Stop postgresql before removing it from services.
  service: name=postgresql state=stopped
  when: supervisor_manage_postgres

- name: Disable postgresql init script for stuff managed by supervisor.
  service: name=postgresql enabled=false
#  command: update-rc.d -f postgresql remove || true
  when: supervisor_manage_postgres

- name: Stop slurm service before removing it.
  service: name=slurm-llnl state=stopped
  when: supervisor_manage_slurm

- name: Disable slurm init script for stuff managed by supervisor.
  service: name=slurm-llnl enabled=false
#  command: update-rc.d -f slurm-llnl remove || true
  when: supervisor_manage_slurm

- name: Stop proftpd service before removing them.
  service: name=proftpd state=stopped
  when: supervisor_manage_proftp

- name: Disable proftpd init script for stuff managed by supervisor.
  service: name=proftpd enabled=false
#  command: update-rc.d -f proftpd remove || true
  when: supervisor_manage_proftp

- name: Stop nginx service before removing them.
  service: name=nginx state=stopped
  when: supervisor_manage_nginx

- name: Disable nginx init script for stuff managed by supervisor.
  service: name=nginx enabled=false
#  command: update-rc.d -f nginx remove || true
  when: supervisor_manage_nginx
